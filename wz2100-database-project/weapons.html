<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <script src="scripts/jquery-2.0.3.js"></script>
    <script src="scripts/jquery-ui-1.10.3.custom/js/jquery-ui-1.10.3.custom.js"></script>
    <script src="scripts/jquery.blockUI.js"></script>
    <link href="scripts/jquery-ui-1.10.3.custom/css/custom-theme/jquery-ui-1.10.3.custom.css" rel="stylesheet" />
    <link href="Styles/MyCustomStyles.css" rel="stylesheet" />

    <link href="scripts/jquery.jqGrid-4.5.2/css/ui.jqgrid.css" rel="stylesheet" />
    <script src="scripts/jquery.jqGrid-4.5.2/js/jquery.jqGrid.src.js"></script>
    <script type="text/javascript" src="scripts/jquery.jqGrid-4.5.2/js/i18n/grid.locale-en.js"></script>
    <script src="scripts/jquery.blockUI.js"></script>

    <script src="scripts/MyCustomScripts2.js"></script>
    <script src="scripts/common_objects.js"></script>
    <script src="scripts/designer_functions.js"></script>
    <script src="scripts/research_functions.js"></script>

    <title></title>

    <script>

        $(function () {

            InitDataObjects();
            $("#tabs_left").tabs();
            $("#tabs_left").tabs("option", "active", 0);

            $('#tabs_left ul:first li:eq(0) a').click(null, function (event) {
                
            });

            $('#tabs_left ul:first li:eq(1) a').click(null, function (event) {

            });

            $('#tabs_left ul:first li:eq(2) a').click(null, function (event) {

            });

            $('#tabs_left ul:first li:eq(3) a').click(null, function (event) {

                var html = "";
                html += '<div class="ui-widget-header ui-corner-top" style="padding: 5px;">Propulsion Damage Modifiers</div><div id="propulsion_modifiers" class="ui-widget-content ui-corner-bottom"></div>';

                html += '<div class="ui-widget-header ui-corner-top"  style="padding: 5px; margin-top:10px">Structure Damage Modifiers</div><div id="structure_modifiers"></div>';
                $("#left-tabs-1").html(html);

                LoadDataObject(StructureModifiers, function () {
                    LoadDataObject(PropulsionModifiers, function () {
                        DrawGrid(PropulsionModifiers, "propulsion_modifiers",null, 600);
                        DrawGrid(StructureModifiers, "structure_modifiers", null, 600);
                    });
                });
            });


            LoadAllObjects(function () {
                DoResearch(7200, player_all_researched, function () {
                    /* Researchable weapons */
                    var collected_weapons = {};
                    /* Tank weapons */
                    var func_tank_weapons = function (weapon) {
                        if (weapon.designable == undefined) {/* Check Weapon designable */
                            return false;
                        }
                        if(ResearchedComponents[player_all_researched][weapon.grid_id] == undefined)/* Check Weapon can be researched */
                        {
                            return false;
                        }
                        var abils = Weapon_GetAbilities(weapon);
                        if (abils.VTOLWeapon || abils.CyborgWeapon) {/* Check Weapon not VTOL, not Cyborg */
                            return false;
                        }
                        collected_weapons[weapon.grid_id] = 1;
                        return true;
                    };
                    DrawWeaponLines('tank_weapons', func_tank_weapons);

                    /* Cyborgs Weapons */
                    var func_cyborgs_weapons = function (weapon) {
                        if (ResearchedComponents[player_all_researched][weapon.grid_id] == undefined)/* Check Weapon can be researched */
                        {
                            return false;
                        }
                        var abils = Weapon_GetAbilities(weapon);
                        if (!abils.CyborgWeapon) {/* Check Weapon is cyborg weapon */
                            return false;
                        }
                        collected_weapons[weapon.grid_id] = 1;
                        return true;
                    };
                    DrawWeaponLines('cyborg_weapons', func_cyborgs_weapons);

                    /* VTOL Weapons */
                    var func_vtol_weapons = function (weapon) {
                        if (weapon.designable == undefined) {/* Check Weapon designable */
                            return false;
                        }
                        if (ResearchedComponents[player_all_researched][weapon.grid_id] == undefined)/* Check Weapon can be researched */
                        {
                            return false;
                        }
                        var abils = Weapon_GetAbilities(weapon);
                        if (!abils.VTOLWeapon) {/* Check Weapon is VTOL-Weapon */
                            return false;
                        }
                        collected_weapons[weapon.grid_id] = 1;
                        return true;
                    };
                    DrawWeaponLines('vtol_weapons', func_vtol_weapons);

                    /* Other weapons */
                    var building_weapons = {};
                    {
                        /* Collect weapons used for buildings */
                        for (var i = 0; i < Structures.loaded_data.length; i++) {
                            if (Structures.loaded_data[i].weapons != undefined) {
                                if (ResearchedComponents[player_all_researched][Structures.loaded_data[i].grid_id] == undefined) {
                                    //skip structures which cannot be researched
                                    continue;
                                }
                                var struc_weaps = Structures.loaded_data[i].weapons.split(',');
                                for (var e = 0 ; e < struc_weaps.length; e++) {
                                    building_weapons[struc_weaps[e]] = 1;
                                }
                            }
                        }
                    }
                    var func_other_weapons = function (weapon) {
                        if (collected_weapons[weapon.grid_id] != undefined) { // skip weapons which was listed already
                            return false;
                        }

                        if (building_weapons[weapon.grid_id] == undefined && ResearchedComponents[player_all_researched][weapon.grid_id] == undefined) { 
                            return false; //skip non-researchable weapons which also not used on buildings
                        }
                        
                        collected_weapons[weapon.grid_id] = 1;
                        return true;
                    };
                    DrawWeaponLines('other_weapons', func_other_weapons);

                    /* Weapon which we cannot research */
                    var func_nonres_weapons = function (weapon) {
                        if (collected_weapons[weapon.grid_id] != undefined) { // skip weapons which was listed already
                            return false;
                        }
                        return true;
                    };
                    DrawWeaponLines('nonres_weapons', func_nonres_weapons);
                });
            });



            //attach click events to each tab
            //for (var i = 0; i < Objects.length; i++) {
            //    $('#tabs_left ul:first li:eq(' + Objects[i].tab_index + ') a').click(Objects[i], function (event) {
            //        var DataObject = event.data;
            //        DataObject.LoadLeftGridFunction();
            //    });
            //}

            //SelectedObject.LoadLeftGridFunction();
        });

        var tmp_uniq_index = 0;
        function DrawWeaponLines(container_id, weapon_filer_function) {

            var WeapLines = {};
            var WeapLines_array = [];
            for(var weap_id in Weapons.loaded_data_hash)
            {
                var res_comp_item = ResearchedComponents[player_all_researched][weap_id];
                var weapon = Weapons.loaded_data_hash[weap_id];
                if (!weapon_filer_function(weapon)) {
                    continue;
                }
                if(res_comp_item == undefined)
                {
                    continue;
                }

                var weapSubClass = weapon.weaponSubClass;
                if(weapSubClass == undefined)
                {
                    continue;
                }

                weap_line = WeapLines[weapSubClass];
                if(weap_line == undefined)
                {
                    weap_line = {};
                    weap_line.weaponSubClass = weapSubClass;
                    weap_line.min_research_time = res_comp_item.time_seconds;
                    weap_line.weapons = {};
                    weap_line.weapons[weap_id] = weapon;
                    WeapLines[weapSubClass] = weap_line;  
                    WeapLines_array.push(weap_line);
                }else
                {
                    weap_line.min_research_time = Math.min(weap_line.min_research_time, res_comp_item.time_seconds);
                    weap_line.weapons[weap_id] = weapon;
                }
            }

            WeapLines_array.sort(function (elm1, elm2) {
                return elm1.min_research_time - elm2.min_research_time;
            });
            $("#" + container_id).html("");
            for(var i=0; i < WeapLines_array.length; i++)
            {
                var grid_container_name = container_id + "_" + tmp_uniq_index++;
                var elem = $('<div id="' + grid_container_name + '"></div>');
                elem.appendTo($("#" + container_id));
                DrawWeaponLine(WeapLines_array[i].weaponSubClass, WeapLines_array[i].weapons, grid_container_name);
            }
        }

        function DrawWeaponLine(weaponSubClass, weapons_list, container_id) {

            var grid_data = [];
            for (var weap_id in weapons_list) {
                var weap = weapons_list[weap_id];
                grid_data.push(weap);
            }

            var grid_element_id = ResetGridContainer(container_id);
            var grid = $(grid_element_id);
            grid.jqGrid
            ({
                datatype: "local",
                data: grid_data,
                rowNum: grid_data.length,
                height: 'auto',
                colModel:
                    [

                        { label: "", name: "grid_id", key: true, hidden: true },
                        {
                            label: " ",
                            name: 'pic',
                            width: '65px',
                            sortable: false,
                            search: false,
                            formatter: function (cellvalue, options, rowObject) {
                                return Weapons.GetIconHtml_Function(rowObject);
                            },
                        },
                        { label: "name", name: "name"},
                    ],
                onSelectRow: function (rowid) {
                },
                loadonce: true,
                ignoreCase: true, //make search case insensitive
            });


        }

        function FormWeaponLine_Html(weapon) {


        }


    </script>
</head>
<body style="background:#eeeeee;">
    <table style="width:95%;max-width:1200px;min-width:800px ;margin-left: auto ; margin-right: auto ;">
        <tr>
            <td id="page_header">

            </td>
        </tr>
        <tr>
            <td id="page_caption" data-caption="Weapons Guide">

            </td>
        </tr>
    <tr>
        <td style="width:100%;vertical-align:top">
            <div id="tabs_left" >
                <ul>
                    <li><a href="#left-tabs-1">Weapon Guide</a></li>
                    <li><a href="#left-tabs-1">Weapons List</a></li>
                    <li><a href="#left-tabs-1">Weapon detail</a></li>
                    <li><a href="#left-tabs-1">Damage Modifiers</a></li>
                    <li><a href="#left-tabs-1">Best Weapons</a></li>
                </ul>
                <div id="left-tabs-1">

                    <div class="ui-accordion ui-widget ui-helper-reset" role="tablist">
	                    <h3 style="text-align:left" class="ui-accordion-header ui-helper-reset ui-state-default ui-accordion-icons ui-accordion-header-active ui-state-active ui-corner-top">
                            <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-s" style="float:left;"></span>
                            <a href="#">Tank Weapons</a>
	                    </h3>
                        <div id="tank_weapons" class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content-active" style="display: block; text-align:left">
                        </div>
                    </div>

                    <div class="ui-accordion ui-widget ui-helper-reset" role="tablist">
	                    <h3 style="text-align:left" class="ui-accordion-header ui-helper-reset ui-state-default ui-accordion-icons ui-accordion-header-active ui-state-active ui-corner-top">
                            <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-s" style="float:left;"></span>
                            <a href="#">Cyborg Weapons</a>
	                    </h3>
                        <div id="cyborg_weapons" class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content-active" style="display: block; text-align:left">
                        </div>
                    </div>

                    <div class="ui-accordion ui-widget ui-helper-reset" role="tablist">
	                    <h3 style="text-align:left" class="ui-accordion-header ui-helper-reset ui-state-default ui-accordion-icons ui-accordion-header-active ui-state-active ui-corner-top">
                            <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-s" style="float:left;"></span>
                            <a href="#">VTOL Weapons</a>
	                    </h3>
                        <div id="vtol_weapons" class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content-active" style="display: block; text-align:left">
                        </div>
                    </div>

                    <div class="ui-accordion ui-widget ui-helper-reset" role="tablist">
	                    <h3 style="text-align:left" class="ui-accordion-header ui-helper-reset ui-state-default ui-accordion-icons ui-accordion-header-active ui-state-active ui-corner-top">
                            <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-s" style="float:left;"></span>
                            <a href="#">Other Weapons</a>
	                    </h3>
                        <div id="other_weapons" class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content-active" style="display: block; text-align:left">
                        </div>
                    </div>

                    <div class="ui-accordion ui-widget ui-helper-reset" role="tablist">
	                    <h3 style="text-align:left" class="ui-accordion-header ui-helper-reset ui-state-default ui-accordion-icons ui-accordion-header-active ui-state-active ui-corner-top">
                            <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-s" style="float:left;"></span>
                            <a href="#">Unavailable Weapons</a>
	                    </h3>
                        <div id="nonres_weapons" class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content-active" style="display: block; text-align:left">
                        </div>
                    </div>

                </div>
            </div>
        </td>
    </tr>
    </table>

    <div id="modifiers_container" style="display:none">

    </div>

        <label style="float:right; margin-right:100px; color:gray">made by crab_ ©</label>
</body>
</html>
